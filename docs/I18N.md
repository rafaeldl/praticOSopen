# I18N.md - Sistema de Internacionalização

## Visão Geral

O PraticOS implementa um sistema completo de internacionalização (i18n) para suportar múltiplos idiomas e formatos regionais.

**Idiomas suportados:**
- Português (pt-BR) - Principal
- Inglês (en-US)
- Espanhol (es-ES)

## Arquitetura

### Estrutura de Arquivos

```
lib/l10n/
├── app_en.arb                      # Traduções em inglês
├── app_es.arb                      # Traduções em espanhol
├── app_pt.arb                      # Traduções em português (fonte)
├── app_localizations.dart          # Classe base gerada
├── app_localizations_en.dart       # Implementação inglês
├── app_localizations_es.dart       # Implementação espanhol
└── app_localizations_pt.dart       # Implementação português
```

### Ferramentas

1. **Flutter l10n**: Gera classes de localização a partir de arquivos .arb
2. **FormatService**: Serviço centralizado para formatação de datas, números e moedas

## Uso no Código

### 1. Strings Traduzidas

```dart
import 'package:praticos/extensions/context_extensions.dart';

// Em qualquer widget com BuildContext
Text(context.l10n.save)
Text(context.l10n.cancel)
```

### 2. Strings com Placeholders

**Definição no .arb:**
```json
{
  "welcome": "Bem-vindo, {name}!",
  "@welcome": {
    "placeholders": {
      "name": {
        "type": "String"
      }
    }
  }
}
```

**Uso:**
```dart
Text(context.l10n.welcome('João'))
```

### 3. Plurais (ICU Format)

**Definição no .arb:**
```json
{
  "itemCount": "{count} {count, plural, =1{item} other{itens}}",
  "@itemCount": {
    "placeholders": {
      "count": {
        "type": "int"
      }
    }
  }
}
```

**Uso:**
```dart
Text(context.l10n.itemCount(5))  // "5 itens"
Text(context.l10n.itemCount(1))  // "1 item"
```

## FormatService

Serviço singleton para formatação consciente de locale.

### Inicialização

```dart
import 'package:praticos/services/format_service.dart';
import 'package:praticos/l10n/app_localizations.dart';

// No início da app ou ao trocar idioma
final formatService = FormatService();
formatService.setLocale(AppLocalizations.of(context).localeName);
```

### Formatação de Datas

```dart
final formatService = FormatService();

// Data curta (09/01/2025, 01/09/2025, 09/01/2025)
formatService.formatDate(DateTime.now());

// Data com hora (09/01/2025 14:30, 01/09/2025 2:30 PM)
formatService.formatDateTime(DateTime.now());

// Data longa (9 de janeiro de 2025)
formatService.formatDateLong(DateTime.now());

// Dia e mês (09/01, 01/09)
formatService.formatDayMonth(DateTime.now());

// Apenas hora (14:30, 2:30 PM)
formatService.formatTime(DateTime.now());
```

### Formatação de Moedas e Números

```dart
// Moeda com símbolo do país
formatService.formatCurrency(1234.56);
// pt-BR → R$ 1.234,56
// en-US → $1,234.56
// es-ES → 1.234,56 €

// Número decimal
formatService.formatDecimal(1234.56);
// pt-BR → 1.234,56
// en-US → 1,234.56

// Porcentagem
formatService.formatPercent(15.5);
// Todos → 15,5%
```

### Parsing de Valores

```dart
// Para parsear valores inseridos pelo usuário (ex: TextFields de moeda)
double _parseValue(String value) {
  try {
    final formatService = FormatService();
    final parsed = formatService.currencyFormat.parse(value);
    return parsed.toDouble();
  } catch (e) {
    // Fallback manual se necessário
    return 0;
  }
}
```

## Adicionar Nova Tradução

### Passo 1: Adicionar chave no .arb fonte (pt)

```json
// lib/l10n/app_pt.arb
{
  "newKey": "Texto em português",
  "keyWithParam": "Olá {name}",
  "@keyWithParam": {
    "placeholders": {
      "name": {
        "type": "String"
      }
    }
  }
}
```

### Passo 2: Adicionar traduções

```json
// lib/l10n/app_en.arb
{
  "newKey": "Text in English",
  "keyWithParam": "Hello {name}"
}

// lib/l10n/app_es.arb
{
  "newKey": "Texto en español",
  "keyWithParam": "Hola {name}"
}
```

### Passo 3: Gerar arquivos de localização

```bash
fvm flutter gen-l10n
```

### Passo 4: Usar no código

```dart
Text(context.l10n.newKey)
Text(context.l10n.keyWithParam('João'))
```

## Modelos com Localização

Modelos que precisam retornar strings localizadas devem aceitar `AppLocalizations` como parâmetro:

```dart
class PaymentTransaction {
  PaymentTransactionType type;

  // ❌ ERRADO - Hardcoded
  String get typeLabel {
    switch (type) {
      case PaymentTransactionType.payment:
        return 'Pagamento';
      case PaymentTransactionType.discount:
        return 'Desconto';
    }
  }

  // ✅ CORRETO - Localizado
  String typeLabel(AppLocalizations l10n) {
    switch (type) {
      case PaymentTransactionType.payment:
        return l10n.payment;
      case PaymentTransactionType.discount:
        return l10n.discount;
    }
  }
}

// Uso:
Text(transaction.typeLabel(context.l10n))
```

## Regras Importantes

### ✅ SEMPRE Localizar

- Títulos de telas
- Labels de campos
- Botões
- Mensagens de erro/sucesso
- Placeholders de campos de entrada
- Headers de seções
- Estados vazios (empty states)
- Diálogos e confirmações

### ❌ NÃO Localizar

- Nomes próprios (nomes de clientes, empresas)
- Dados inseridos pelo usuário
- IDs técnicos
- Logs de debug
- Comentários de código (preferir inglês)

### ⚠️ Cuidados Especiais

1. **Números e Moedas**: Sempre usar `FormatService`, nunca formatar manualmente
2. **Datas**: Sempre usar `FormatService`, nunca usar `DateFormat` diretamente
3. **Parsing**: Usar `NumberFormat.parse()` para parsear valores do usuário
4. **Dark Mode**: Ao usar `.resolveFrom(context)`, o locale já está disponível no context

## Detecção de Locale

O locale é detectado automaticamente pelo sistema operacional:

```dart
// MaterialApp ou CupertinoApp
MaterialApp(
  localizationsDelegates: AppLocalizations.localizationsDelegates,
  supportedLocales: AppLocalizations.supportedLocales,
  // ...
)
```

O locale atual pode ser acessado via:
```dart
final locale = AppLocalizations.of(context).localeName;  // 'pt', 'en', 'es'
```

## Testes

Para testar diferentes locales em desenvolvimento:

### iOS Simulator
1. Settings → General → Language & Region
2. Escolher idioma (English, Español, Português)
3. Reiniciar app

### Android Emulator
1. Settings → System → Languages & input → Languages
2. Adicionar idioma e mover para o topo
3. Reiniciar app

## Migração de Código Existente

### Identificar Strings Hardcoded

```bash
# Buscar strings em português hardcoded
grep -r "['\"]\w*[àáâãçéêíóôõú]\w*['\"]" lib/screens/
```

### Processo de Migração

1. Identificar todas as strings hardcoded na tela
2. Criar chaves de tradução nos 3 arquivos .arb
3. Executar `fvm flutter gen-l10n`
4. Substituir strings por `context.l10n.key`
5. Testar em todos os idiomas suportados

## Recursos Adicionais

- **Flutter Internationalization**: https://docs.flutter.dev/development/accessibility-and-localization/internationalization
- **ICU Message Format**: https://unicode-org.github.io/icu/userguide/format_parse/messages/
- **intl Package**: https://pub.dev/packages/intl
